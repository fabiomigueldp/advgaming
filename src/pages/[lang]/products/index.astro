---
/**
 * Products Listing Page
 * Displays all products with filtering options
 */
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import ProductCard from "@components/cards/ProductCard.astro";
import { SUPPORTED_LOCALES, DEFAULT_LOCALE, type SupportedLocale } from "@util/translate";

export async function getStaticPaths() {
  const paths = SUPPORTED_LOCALES.map((locale) => ({
    params: { lang: locale },
    props: { lang: locale }
  }));
  return paths;
}

interface Props {
  lang: SupportedLocale;
}

const { lang } = Astro.props;

// Get all products for current locale
const allProducts = await getCollection("products");
const products = allProducts
  .filter((p) => p.slug.startsWith(`${lang}/`))
  .sort((a, b) => a.data.sort_order - b.data.sort_order);

const pageTitle = "Streamer Kits";
const pageDescription = "Kits profissionais para streamers. Starter Pack gratuito, Creator Pack personalizado e kit sob demanda.";
---

<BaseLayout title={pageTitle} description={pageDescription} lang={lang}>
  <main class="surface-dark min-h-screen">
    <!-- Hero Section -->
     <section class="products-hero pt-32 pb-16">
       <div class="container-xl">
         <div class="max-w-3xl">
           <p class="products-hero__eyebrow">Streamer Kits</p>
           <h1 class="title mb-4" style="color: rgb(var(--fg));">Escolha seu kit, eleve sua stream</h1>
           <p class="text-xl" style="color: rgb(var(--muted-fg));">
             Kits profissionais desenvolvidos para streamers em qualquer etapa.
             Do Starter Pack gratuito ao Creator Pack e opcoes sob demanda.
           </p>
         </div>
       </div>
     </section>

    <!-- Filters -->
    <section class="pb-8">
      <div class="container-xl">
        <div class="flex flex-wrap gap-2" id="product-filters">
          <button 
            class="filter-btn active" 
            data-filter="all"
          >
            Todos
          </button>
           <button
             class="filter-btn"
             data-filter="free"
           >
             Starter Pack
           </button>
           <button
             class="filter-btn"
             data-filter="basic"
           >
             Creator Pack
           </button>
           <button
             class="filter-btn"
             data-filter="custom"
           >
             Personalizado
           </button>
        </div>
      </div>
    </section>

    <!-- Products Grid -->
    <section class="pb-20">
      <div class="container-xl">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="products-grid">
          {products.map((product) => (
            <div class="product-item" data-level={product.data.product_level}>
              <ProductCard product={product} lang={lang} />
            </div>
          ))}
        </div>
        
      {products.length === 0 && (
        <div class="text-center py-20">
          <p class="text-neutral-500 text-lg">Nenhum produto encontrado.</p>
        </div>
      )}
      </div>
    </section>

    <!-- Comparison CTA -->
    <section class="products-cta py-16" style="border-top: 1px solid rgb(var(--border));">
      <div class="container-xl text-center">
        <h2 class="text-2xl font-bold mb-4" style="color: rgb(var(--fg));">Nao sabe qual escolher?</h2>
        <p class="mb-8 max-w-xl mx-auto" style="color: rgb(var(--muted-fg));">
          Compare os pacotes e escolha o ideal para o seu momento.
        </p>
        <a href="#comparison" class="btn btn-outline">
          Comparar Kits
        </a>
      </div>
    </section>

    <!-- Comparison Table -->
    <section class="products-compare py-16" id="comparison" style="background-color: rgb(var(--muted-bg));">
      <div class="container-xl">
        <h2 class="text-2xl font-bold mb-8 text-center" style="color: rgb(var(--fg));">Comparacao de Kits</h2>

         <div class="overflow-x-auto">
           <table class="w-full text-left comparison-table">
            <thead>
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <th class="py-4 px-4 font-medium" style="color: rgb(var(--muted-fg));">Recurso</th>
                <th class="py-4 px-4 text-center" style="color: rgb(var(--color-success));">Starter Pack</th>
                <th class="py-4 px-4 text-center" style="color: rgb(var(--color-info));">Creator Pack</th>
                <th class="py-4 px-4 text-center" style="color: rgb(var(--color-accent));">Personalizado</th>
              </tr>
            </thead>
            <tbody class="text-sm">
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <td class="py-4 px-4 font-medium" style="color: rgb(var(--fg));">Telas inclusas</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">3</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">5</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Sob demanda</td>
              </tr>
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <td class="py-4 px-4 font-medium" style="color: rgb(var(--fg));">Personalizacao do nome</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--muted-fg));">Nao</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Sim</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Completa</td>
              </tr>
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <td class="py-4 px-4 font-medium" style="color: rgb(var(--fg));">Pronto para OBS</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Sim</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Sim</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Sim</td>
              </tr>
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <td class="py-4 px-4 font-medium" style="color: rgb(var(--fg));">Entrega</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Imediata</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">1 dia util</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">A combinar</td>
              </tr>
              <tr style="border-bottom: 1px solid rgb(var(--border));">
                <td class="py-4 px-4 font-medium" style="color: rgb(var(--fg));">Ideal para</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Iniciantes</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Criadores em crescimento</td>
                <td class="py-4 px-4 text-center" style="color: rgb(var(--fg));">Profissionais</td>
              </tr>
              <tr>
                <td class="py-4 px-4 font-bold" style="color: rgb(var(--fg));">Preco</td>
                <td class="py-4 px-4 text-center font-bold" style="color: rgb(var(--color-success));">Gratis</td>
                <td class="py-4 px-4 text-center font-bold" style="color: rgb(var(--color-info));">R$ 24,90</td>
                <td class="py-4 px-4 text-center font-bold" style="color: rgb(var(--color-accent));">Sob consulta</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  .products-hero {
    position: relative;
    overflow: hidden;
  }

  .products-hero::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top right, rgba(220, 38, 38, 0.2), transparent 60%),
      radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.15), transparent 55%);
    pointer-events: none;
  }

  .products-hero__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.75rem;
    color: rgb(var(--muted-fg));
    margin-bottom: 0.5rem;
  }

  .products-cta {
    background: linear-gradient(180deg, rgba(10, 10, 14, 0.6), rgba(6, 6, 9, 0.95));
  }

  .products-compare table {
    border-collapse: collapse;
  }

  .products-compare th,
  .products-compare td {
    border-bottom: 1px solid rgb(var(--border));
  }

  .comparison-table th:first-child,
  .comparison-table td:first-child {
    width: 30%;
  }

  .products-compare tbody tr:hover td {
    background: rgba(15, 15, 20, 0.4);
  }

  .filter-btn {
    @apply px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200;
    background-color: rgb(var(--muted-bg));
    color: rgb(var(--muted-fg));
  }

  .filter-btn:hover {
    background-color: rgb(var(--border));
    color: rgb(var(--fg));
  }

  .filter-btn.active {
    background-color: rgb(var(--color-primary));
    color: rgb(var(--primary-fg));
  }
  
  .product-item {
    @apply transition-opacity duration-300;
  }
  
  .product-item.is-hidden {
    display: none;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const productItems = document.querySelectorAll('.product-item');
    
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const filter = btn.getAttribute('data-filter');
        
        // Update active button
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Filter products
        productItems.forEach(item => {
          const level = item.getAttribute('data-level');
          if (filter === 'all' || level === filter) {
            item.classList.remove('is-hidden');
          } else {
            item.classList.add('is-hidden');
          }
        });
      });
    });
  });
</script>
